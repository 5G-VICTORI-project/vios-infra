---
- name: Setting up new single node cluster vm
  hosts: localhost
  gather_facts: false
  pre_tasks:
    - name: Set variables
      set_fact:
        state: present
  roles:
    - config-cluster

- name: Installing cluster components
  hosts: vios-cluster
  gather_facts: false
  tags:
    - bootstrap
  become: yes
  roles:
    - config-prerequisites
    - config-docker
    - role: config-k8s
      vars:
        cluster_ip: "{{ hostvars['localhost']['instance']['openstack']['public_v4'] }}"

#- name: Installing vios microservices
#  hosts: vios-cluster
#  gather_facts: false
#  become: yes
#  roles:
#    - config-vios
